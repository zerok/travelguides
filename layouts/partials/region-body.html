<div class="page page--region">
    {{ partial "breadcrumbs" . }}

    <div class="grid-x grid-margin-x">
        <div class="medium-auto cell" id="map" data-map-mode="list">
        </div>
        <script src="/js/map.js"></script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ getenv "MAPS_API_KEY" }}&amp;callback=initMap">
        </script>
        <div class="medium-auto cell">
            {{ with $children := where $.Site.Pages ".Params.parent" "==" .File.BaseFileName }}
                {{ if (len $children) gt 0 }}
                <section>
                    <h2>Sub-regions</h2>
                    <ul>
                        {{ range $children }}
                        <li><a title="{{ .Title }}" class="map__marker" data-lat="{{ .Params.pos.lat }}" data-lng="{{ .Params.pos.lng }}" href="{{ .URL | relURL }}">{{ .Title }}</a> ({{ index $.Site.Data.poicount .File.BaseFileName | default 0 }} POIs)</li>
                        {{ end }}
                    </ul>
                </section>
                {{ end }}
            {{ end }}

            {{ with $pois := where $.Site.Pages ".Params.region" "==" .File.BaseFileName }}
                {{ if (len $pois) gt 0 }}
                <section>
                    <h2>POIs</h2>
                    <ul>
                        {{ range $pois }}
                        <li><a title="{{ .Title }}" class="map__marker" data-lat="{{ .Params.pos.lat }}" data-lng="{{ .Params.pos.lng }}" href="{{ .URL | relURL }}">{{ .Title }}</a></li>
                        {{ end }}
                    </ul>
                </section>
                {{ end }}
            {{ end }}

            <a href="https://gitlab.com/strangenewplaces/website/edit/master/content/{{ .File.Path }}" class="button small"><i class="fa fa-pencil"></i> Improve this page</a>
        </div>
    </div>
</div>
